(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{Ny1X:function(t,e,s){"use strict";s.r(e),s.d(e,"RostaModule",function(){return pt});var a=s("ofXK"),i=s("tyNb"),o=s("0IaG"),n=s("l7P3");const c=Object(n.o)("rosta"),l=Object(n.q)(c,t=>t.duties),r=Object(n.q)(c,t=>t.dateFrom),d=Object(n.q)(c,t=>t.staffIdList),f=Object(n.q)(c,t=>t.dutyIdList);var h=s("fXoL"),u=s("MutI"),b=s("3Pt+"),m=s("bTqV");function g(t,e){if(1&t&&(h.Tb(0,"mat-list-option",8),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.lc("value",t.staffId),h.Cb(1),h.Ec(" ",t.userName," ")}}let C=(()=>{class t{constructor(t,e,s){this.dialogRef=t,this.data=e,this.store=s,this.selectedStaff=[],this.selectedStaffIds$=this.store.select(d).subscribe(t=>{this.selectedStaff=t})}ngOnDestroy(){this.selectedStaffIds$&&this.selectedStaffIds$.unsubscribe()}onNoClick(){this.dialogRef.close()}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(o.g),h.Nb(o.a),h.Nb(n.h))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-staff-picker-dialog"]],decls:11,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"ngModel","ngModelChange"],["list",""],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],[3,"value"]],template:function(t,e){1&t&&(h.Tb(0,"h1",0),h.Cc(1,"Select Staff Roster"),h.Sb(),h.Tb(2,"div",1),h.Tb(3,"mat-selection-list",2,3),h.bc("ngModelChange",function(t){return e.selectedStaff=t}),h.Bc(5,g,2,2,"mat-list-option",4),h.Sb(),h.Sb(),h.Tb(6,"div",5),h.Tb(7,"button",6),h.bc("click",function(){return e.onNoClick()}),h.Cc(8,"Cancel"),h.Sb(),h.Tb(9,"button",7),h.Cc(10,"Ok"),h.Sb(),h.Sb()),2&t&&(h.Cb(3),h.lc("ngModel",e.selectedStaff),h.Cb(2),h.lc("ngForOf",e.data),h.Cb(4),h.lc("mat-dialog-close",e.selectedStaff))},directives:[o.h,o.e,u.c,b.k,b.n,a.k,o.c,m.a,o.d,u.b],styles:[""]}),t})();var p=s("sdho"),S=s("4Zo2");function y(t,e){if(1&t&&(h.Tb(0,"mat-list-option",8),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.lc("value",t.dutyId),h.Cb(1),h.Ec(" ",t.dutyType," ")}}let D=(()=>{class t{constructor(t,e,s){this.dialogRef=t,this.data=e,this.store=s,this.selectedDuties=[],this.store.select(f).subscribe(t=>{this.selectedDuties=t})}onNoClick(){this.dialogRef.close()}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(o.g),h.Nb(o.a),h.Nb(n.h))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-location-picker-dialog"]],decls:11,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"ngModel","ngModelChange"],["list",""],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],[3,"value"]],template:function(t,e){1&t&&(h.Tb(0,"h1",0),h.Cc(1,"Select Shift Type"),h.Sb(),h.Tb(2,"div",1),h.Tb(3,"mat-selection-list",2,3),h.bc("ngModelChange",function(t){return e.selectedDuties=t}),h.Bc(5,y,2,2,"mat-list-option",4),h.Sb(),h.Sb(),h.Tb(6,"div",5),h.Tb(7,"button",6),h.bc("click",function(){return e.onNoClick()}),h.Cc(8,"Cancel"),h.Sb(),h.Tb(9,"button",7),h.Cc(10,"Ok"),h.Sb(),h.Sb()),2&t&&(h.Cb(3),h.lc("ngModel",e.selectedDuties),h.Cb(2),h.lc("ngForOf",e.data),h.Cb(4),h.lc("mat-dialog-close",e.selectedDuties))},directives:[o.h,o.e,u.c,b.k,b.n,a.k,o.c,m.a,o.d,u.b],styles:[""]}),t})();var w=s("2NH0"),k=s("/t3+"),O=s("qFsG"),M=s("iadO"),T=s("wZkO"),v=s("+0xr"),I=s("STbY"),P=s("znSr"),R=s("Qu3c");function L(t,e){1&t&&h.Ob(0,"th",13)}function x(t,e){if(1&t&&(h.Tb(0,"td",14),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.lc("ngClass","rowLabel"),h.Cb(1),h.Ec(" ",null==t[0]?null:t[0].userName," ")}}function $(t,e){if(1&t&&(h.Tb(0,"th",13),h.Cc(1),h.Sb()),2&t){const t=h.fc().index,e=h.fc();h.yc("background-color",e.setBackgroundColourCell(t,0)),h.Cb(1),h.Ec(" ",e.setAMorPM(t)," ")}}const F=function(t,e){return{staff:t,col:e}};function _(t,e){if(1&t){const t=h.Ub();h.Tb(0,"td",18),h.bc("click",function(){h.tc(t);const s=e.$implicit,a=h.fc().index;return h.fc().cellClicked(s[0],a)})("menuClosed",function(){return h.tc(t),h.fc(2).menuClosed()}),h.Cc(1),h.Sb()}if(2&t){const t=e.$implicit,s=h.fc().index,a=h.fc(),i=h.rc(14);h.yc("background-color",a.setBackgroundColourCell(s,t[0].staffId)),h.lc("matMenuTriggerFor",i)("matMenuTriggerData",h.pc(7,F,t[0],s))("matTooltip",null==t[1][s]?null:t[1][s].dutyType)("ngClass",a.isSelected(t[0].staffId,s)?"highlight":"notHighlight"),h.Cb(1),h.Ec(" ",null==t[1][s]?null:t[1][s].dutyCode," ")}}function B(t,e){1&t&&(h.Rb(0,15),h.Bc(1,$,2,3,"th",16),h.Bc(2,_,2,10,"td",17),h.Qb()),2&t&&h.mc("matColumnDef",e.$implicit)}function A(t,e){1&t&&h.Ob(0,"th",13),2&t&&h.Db("colspan",1)}function N(t,e){if(1&t&&(h.Tb(0,"th",13),h.Cc(1),h.Sb()),2&t){const t=h.fc().index,e=h.fc();h.yc("background-color",e.setBackgroundColourHeader(t)),h.Db("colspan",2),h.Cb(1),h.Ec(" ",e.headerRowDay[t]," ")}}function H(t,e){1&t&&(h.Rb(0,15),h.Bc(1,N,2,4,"th",16),h.Qb()),2&t&&h.mc("matColumnDef",e.$implicit)}function E(t,e){1&t&&h.Ob(0,"tr",19)}function j(t,e){1&t&&h.Ob(0,"tr",19)}function V(t,e){1&t&&h.Ob(0,"tr",20)}function Q(t,e){if(1&t){const t=h.Ub();h.Tb(0,"button",22),h.bc("click",function(){h.tc(t);const s=e.$implicit,a=h.fc(),i=a.staff,o=a.col;return h.fc().menuClick(i,o,s)}),h.Cc(1),h.Sb()}if(2&t){const t=e.$implicit;h.Cb(1),h.Dc(t.dutyType)}}function q(t,e){if(1&t&&(h.Tb(0,"span"),h.Cc(1,"Edit Duty"),h.Sb(),h.Bc(2,Q,2,1,"button",21)),2&t){const t=h.fc();h.Cb(2),h.lc("ngForOf",t.duties)}}let G=(()=>{class t{constructor(t,e,s){this.rostaService=t,this.store=e,this.locale=s,this.rotaArray=[],this.displayedColumns=[],this.displayedColumns2=[],this.headerRowDef=["h0"],this.headerRowDef2=[],this.headerRowDay=[],this.duties=[],this.selectedSlot=[-1,-1],this.duties$=this.store.select(l),this.duties$.subscribe(t=>{this.duties=t}),this.staffIdList$=this.store.select(d),this.staffIdList$.subscribe(t=>{this.staffIdList=t,this.resetTableData()}),this.weekStart$=this.store.select(r),this.weekStart$.subscribe(t=>{this.weekStart=t,this.setDayLabelRow(t),this.resetTableData()})}setDayLabelRow(t){let e="",s=null;this.headerRowDay=[];for(let i=0;i<14;i++)s=new Date(new Date(this.weekStart).setDate(this.weekStart.getDate()+i)),e=Object(a.t)(s,"E dd/MM",this.locale),this.headerRowDay.push(e)}resetTableData(){this.weekStart&&this.staffIdList&&(this.rotaArray$=this.rostaService.getDutiesFromDate(this.weekStart,this.staffIdList),this.rotaArray$.subscribe(t=>{this.rotaArray=t,console.log("Resetting table Data"),this.dataSource=new v.k(this.rotaArray)}))}ngOnInit(){this.rotaArray$=this.rostaService.getDutiesFromDate(this.weekStart,this.staffIdList),this.rotaArray$.subscribe(t=>{this.rotaArray=t,this.setDesplayedColumns(t),console.log("Setting table date"),this.dataSource=new v.k(this.rotaArray)})}setDesplayedColumns(t){let e;const s=t[0][1];for(this.displayedColumns.push("staff"),e=0;e<s.length;++e)this.displayedColumns.push(e.toString()),this.displayedColumns2.push(e.toString()),e>0&&e%2&&(this.headerRowDef.push("h"+(e/2+.5)),this.headerRowDef2.push("h"+(e/2+.5)))}setAMorPM(t){return t%2?"PM":"AM"}setBackgroundColourCell(t,e){return t>9&&t<14||t>23?"#f2ebff":"000000"}setBackgroundColourHeader(t){return 5===t||6===t||t>11?"#f2ebff":"000000"}cellClicked(t,e){this.selectedSlot=this.selectedSlot[0]===t.staffId&&e===this.selectedSlot[1]?[-1,-1]:[t.staffId,e]}menuClick(t,e,s){console.log("Staff Id = "+t.userName+" index = "+e+" => "+s.dutyCode);let i="",o=0;i=e%2?"PM":"AM",e>1&&(o=e%2?e/2-.5:e/2);const n=new Date(new Date(this.weekStart).setDate(this.weekStart.getDate()+o)),c=Object(a.t)(n,"yyyy-MM-dd",this.locale);this.rostaService.saveOrEditDuty({date:c,session:i,staff:t.staffId,duty:s.dutyId}).subscribe(t=>{this.result=t,console.log("result from save or edit = "+t),this.resetTableData()})}menuClosed(){console.log("Menu closed!"),this.selectedSlot=[-1,-1]}isSelected(t,e){return e===this.selectedSlot[1]&&t===this.selectedSlot[0]}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(w.a),h.Nb(n.h),h.Nb(h.w))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-rosta-staff"]],viewQuery:function(t,e){if(1&t&&h.Gc(v.j,!0),2&t){let t;h.qc(t=h.cc())&&(e.table=t.first)}},decls:16,vars:7,consts:[[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["table",""],["matColumnDef","staff"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"ngClass",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","h0"],["mat-header-row","",4,"matHeaderRowDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["appMenu","matMenu"],["matMenuContent",""],["mat-header-cell",""],["mat-cell","",3,"ngClass"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color",4,"matHeaderCellDef"],["mat-cell","",3,"matMenuTriggerFor","matMenuTriggerData","matTooltip","background-color","ngClass","click","menuClosed",4,"matCellDef"],["mat-cell","",3,"matMenuTriggerFor","matMenuTriggerData","matTooltip","ngClass","click","menuClosed"],["mat-header-row",""],["mat-row",""],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"]],template:function(t,e){1&t&&(h.Tb(0,"div",0),h.Tb(1,"table",1,2),h.Rb(3,3),h.Bc(4,L,1,0,"th",4),h.Bc(5,x,2,2,"td",5),h.Qb(),h.Bc(6,B,3,1,"ng-container",6),h.Rb(7,7),h.Bc(8,A,1,1,"th",4),h.Qb(),h.Bc(9,H,2,1,"ng-container",6),h.Bc(10,E,1,0,"tr",8),h.Bc(11,j,1,0,"tr",9),h.Bc(12,V,1,0,"tr",10),h.Sb(),h.Sb(),h.Tb(13,"mat-menu",null,11),h.Bc(15,q,3,1,"ng-template",12),h.Sb()),2&t&&(h.Cb(1),h.lc("dataSource",e.dataSource),h.Cb(5),h.lc("ngForOf",e.displayedColumns2),h.Cb(3),h.lc("ngForOf",e.headerRowDef2),h.Cb(1),h.lc("matHeaderRowDef",e.headerRowDef),h.Cb(1),h.lc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),h.Cb(1),h.lc("matRowDefColumns",e.displayedColumns))},directives:[v.j,v.c,v.e,v.b,a.k,v.g,v.i,I.a,I.b,v.d,v.a,a.j,P.a,I.e,R.a,v.f,v.h,I.c],styles:["table[_ngcontent-%COMP%]{width:100%}.make-red[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]{background-color:#faa}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}th.mat-header-cell[_ngcontent-%COMP%]{border:1px solid #ccc}td.mat-cell[_ngcontent-%COMP%], th.mat-header-cell[_ngcontent-%COMP%]{text-align:center;padding:0!important}.mat-header-row[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{min-height:30px;height:30px}.mat-menu-item[_ngcontent-%COMP%]{height:25px;line-height:25px}  .mat-menu-panel{max-width:400px!important}.highlight[_ngcontent-%COMP%]{border:2px double #00f}.notHighlight[_ngcontent-%COMP%], .rowLabel[_ngcontent-%COMP%]{border:1px solid #ccc}"]}),t})();var U=s("mrSG");function z(t,e){if(1&t&&(h.Tb(0,"mat-list-option",7),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.lc("value",t.staffId),h.Cb(1),h.Ec(" ",t.userName," ")}}let K=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e,this.selectedStaff=[]}ngOnInit(){this.staffList=this.data.staffList,this.duty=this.data.duty,this.col=this.data.col,this.selectedStaff=this.data.selectedStaff}onNoClick(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(o.g),h.Nb(o.a))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-shift-staff-dialog"]],decls:11,vars:4,consts:[["mat-dialog-content",""],[3,"ngModel","ngModelChange"],["list",""],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],[3,"value"]],template:function(t,e){1&t&&(h.Tb(0,"p"),h.Cc(1),h.Sb(),h.Tb(2,"div",0),h.Tb(3,"mat-selection-list",1,2),h.bc("ngModelChange",function(t){return e.selectedStaff=t}),h.Bc(5,z,2,2,"mat-list-option",3),h.Sb(),h.Sb(),h.Tb(6,"div",4),h.Tb(7,"button",5),h.bc("click",function(){return e.onNoClick()}),h.Cc(8,"Cancel"),h.Sb(),h.Tb(9,"button",6),h.Cc(10,"Ok"),h.Sb(),h.Sb()),2&t&&(h.Cb(1),h.Ec("Select Staff for ",e.duty.dutyType," on date!!!"),h.Cb(2),h.lc("ngModel",e.selectedStaff),h.Cb(2),h.lc("ngForOf",e.data.staffList),h.Cb(4),h.lc("mat-dialog-close",e.selectedStaff))},directives:[o.e,u.c,b.k,b.n,a.k,o.c,m.a,o.d,u.b],styles:[""]}),t})();function J(t,e){1&t&&h.Ob(0,"th",13)}function X(t,e){if(1&t&&(h.Tb(0,"td",14),h.Cc(1),h.Sb()),2&t){const t=e.$implicit;h.lc("ngClass","rowLabel"),h.Cb(1),h.Ec(" ",null==t[0]?null:t[0].dutyType," ")}}function W(t,e){if(1&t&&(h.Tb(0,"th",13),h.Cc(1),h.Sb()),2&t){const t=h.fc().index,e=h.fc();h.yc("background-color",e.setBackgroundColourCell(t)),h.Cb(1),h.Ec(" ",e.setAMorPM(t)," ")}}function Z(t,e){if(1&t){const t=h.Ub();h.Tb(0,"td",18),h.bc("click",function(){h.tc(t);const s=e.$implicit,a=h.fc().index;return h.fc().cellClicked(s[0],a,s[1][a])}),h.Cc(1),h.Sb()}if(2&t){const t=e.$implicit,s=h.fc().index,a=h.fc();h.yc("background-color",a.setBackgroundColourCell(s)),h.lc("matTooltip",a.getStaffArrayNames(t[1][s]))("ngClass",a.isSelected(t[0].dutyId,s)?"highlight":"notHighlight"),h.Cb(1),h.Ec(" ",a.getStaffArray(t[1][s])," ")}}function Y(t,e){1&t&&(h.Rb(0,15),h.Bc(1,W,2,3,"th",16),h.Bc(2,Z,2,5,"td",17),h.Qb()),2&t&&h.mc("matColumnDef",e.$implicit)}function tt(t,e){1&t&&h.Ob(0,"th",13),2&t&&h.Db("colspan",1)}function et(t,e){if(1&t&&(h.Tb(0,"th",13),h.Cc(1),h.Sb()),2&t){const t=h.fc().index,e=h.fc();h.yc("background-color",e.setBackgroundColourHeader(t)),h.Db("colspan",2),h.Cb(1),h.Ec(" ",e.headerRowDay[t]," ")}}function st(t,e){1&t&&(h.Rb(0,15),h.Bc(1,et,2,4,"th",16),h.Qb()),2&t&&h.mc("matColumnDef",e.$implicit)}function at(t,e){1&t&&h.Ob(0,"tr",19)}function it(t,e){1&t&&h.Ob(0,"tr",19)}function ot(t,e){1&t&&h.Ob(0,"tr",20)}function nt(t,e){if(1&t){const t=h.Ub();h.Tb(0,"button",22),h.bc("click",function(){h.tc(t);const s=e.$implicit,a=h.fc(),i=a.col,o=a.duty;return h.fc().menuClick(s,i,o)}),h.Cc(1),h.Sb()}if(2&t){const t=e.$implicit;h.Cb(1),h.Dc(t.userName)}}function ct(t,e){if(1&t&&(h.Tb(0,"span"),h.Cc(1,"Edit Staff"),h.Sb(),h.Bc(2,nt,2,1,"button",21)),2&t){const t=h.fc();h.Cb(2),h.lc("ngForOf",t.staff)}}let lt=(()=>{class t{constructor(t,e,s,a){this.dialog=t,this.rostaService=e,this.store=s,this.locale=a,this.rotaArrayDV=[],this.displayedColumns=[],this.displayedColumns2=[],this.headerRowDef=["h0"],this.headerRowDef2=[],this.headerRowDay=[],this.duties=[],this.staff=[],this.selectedSlot=[-1,-1],this.preSelectedStaffIdList=[],this.duties$=this.store.select(l),this.duties$.subscribe(t=>{this.duties=t}),this.staffIdList$=this.store.select(d),this.staffIdList$.subscribe(t=>{this.staffIdList=t,this.resetTableData(t)}),this.staff$=this.rostaService.getStaffList(),this.staff$.subscribe(t=>{this.staff=t}),this.dutyIdArray$=this.store.select(f),this.dutyIdArray$.subscribe(t=>{this.dutyIdArray=t,this.resetTableData(t)}),this.weekStart$=this.store.select(r),this.weekStart$.subscribe(t=>{this.weekStart=t,this.setDayLabelRow(t),this.resetTableData(t)})}setDayLabelRow(t){let e="",s=null;this.headerRowDay=[];for(let i=0;i<14;i++)s=new Date(new Date(this.weekStart).setDate(this.weekStart.getDate()+i)),e=Object(a.t)(s,"E dd/MM",this.locale),this.headerRowDay.push(e)}resetTableData(t){this.weekStart&&this.staffIdList&&(this.rotaArrayDV$=this.rostaService.getStaffPerDutyFromDate(this.weekStart,this.dutyIdArray),this.rotaArrayDV$.subscribe(t=>{this.rotaArrayDV=t,console.log("Resetting table Data"),this.dataSource=new v.k(this.rotaArrayDV)}))}ngOnInit(){this.rotaArrayDV$=this.rostaService.getStaffPerDutyFromDate(this.weekStart,this.dutyIdArray),this.rotaArrayDV$.subscribe(t=>{this.rotaArrayDV=t,this.setDesplayedColumns(t),console.log("Setting table date"),this.dataSource=new v.k(this.rotaArrayDV)})}setDesplayedColumns(t){let e;const s=t[0][1];for(this.displayedColumns.push("duty"),e=0;e<s.length;++e)this.displayedColumns.push(e.toString()),this.displayedColumns2.push(e.toString()),e>0&&e%2&&(this.headerRowDef.push("h"+(e/2+.5)),this.headerRowDef2.push("h"+(e/2+.5)))}setAMorPM(t){return t%2?"PM":"AM"}setBackgroundColourCell(t){return t>9&&t<14||t>23?"#f2ebff":"000000"}setBackgroundColourHeader(t){return 5===t||6===t||t>11?"#f2ebff":"000000"}getStaffArray(t){let e="";if(t)for(const s of t)e=e+" "+s.initials;return e}getStaffArrayNames(t){let e="";if(t)for(const s of t)e=e+" "+s.userName+",";return e}cellClicked(t,e,s){this.selectedSlot[0]===t.dutyId&&e===this.selectedSlot[1]?this.selectedSlot=[-1,-1]:(this.selectedSlot=[t.dutyId,e],this.preSelectedStaffIdList=s?this.getSelectedStaffIdArray(s):[],this.openSP2Dialog(t,e,this.preSelectedStaffIdList))}getSelectedStaffIdArray(t){const e=[];for(const s of t)e.push(s.staffId);return e}menuClick(t,e,s){}menuClosed(){console.log("Menu closed!"),this.selectedSlot=[-1,-1]}openSP2Dialog(t,e,s){this.dialog.open(K,{width:"250px",data:{staffList:this.staff,duty:t,col:e,selectedStaff:s}}).afterClosed().subscribe(e=>{if(e){let s="",i=0;s=this.selectedSlot[1]%2?"PM":"AM",this.selectedSlot[1]>1&&(i=this.selectedSlot[1]%2?this.selectedSlot[1]/2-.5:this.selectedSlot[1]/2);const o=new Date(new Date(this.weekStart).setDate(this.weekStart.getDate()+i)),n=Object(a.t)(o,"yyyy-MM-dd",this.locale);for(const a of e)console.log("Saving StaffId = "+a),this.saveAndReset({date:n,session:s,staff:a,duty:t.dutyId});this.preSelectedStaffIdList.length>0&&this.preSelectedStaffIdList.forEach(t=>{this.checkIfIdinList(t,e)||(console.log("Need to cancel shift for ID = "+t),this.saveAndReset({date:n,session:s,staff:t,duty:0}))})}this.selectedSlot=[-1,-1]})}saveAndReset(t){return Object(U.a)(this,void 0,void 0,function*(){console.log("saving start");const e=yield this.rostaService.saveOrEditDuty(t).toPromise();this.resetTableData(e),console.log("saving end")})}checkIfIdinList(t,e){for(const s of e)if(s===t)return!0;return!1}isSelected(t,e){return e===this.selectedSlot[1]&&t===this.selectedSlot[0]}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(o.b),h.Nb(w.a),h.Nb(n.h),h.Nb(h.w))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-rosta-location"]],viewQuery:function(t,e){if(1&t&&h.Gc(v.j,!0),2&t){let t;h.qc(t=h.cc())&&(e.table=t.first)}},decls:16,vars:7,consts:[[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["table",""],["matColumnDef","duty"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"ngClass",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","h0"],["mat-header-row","",4,"matHeaderRowDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["appMenu","matMenu"],["matMenuContent",""],["mat-header-cell",""],["mat-cell","",3,"ngClass"],[3,"matColumnDef"],["mat-header-cell","",3,"background-color",4,"matHeaderCellDef"],["mat-cell","",3,"matTooltip","background-color","ngClass","click",4,"matCellDef"],["mat-cell","",3,"matTooltip","ngClass","click"],["mat-header-row",""],["mat-row",""],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"]],template:function(t,e){1&t&&(h.Tb(0,"div",0),h.Tb(1,"table",1,2),h.Rb(3,3),h.Bc(4,J,1,0,"th",4),h.Bc(5,X,2,2,"td",5),h.Qb(),h.Bc(6,Y,3,1,"ng-container",6),h.Rb(7,7),h.Bc(8,tt,1,1,"th",4),h.Qb(),h.Bc(9,st,2,1,"ng-container",6),h.Bc(10,at,1,0,"tr",8),h.Bc(11,it,1,0,"tr",9),h.Bc(12,ot,1,0,"tr",10),h.Sb(),h.Sb(),h.Tb(13,"mat-menu",null,11),h.Bc(15,ct,3,1,"ng-template",12),h.Sb()),2&t&&(h.Cb(1),h.lc("dataSource",e.dataSource),h.Cb(5),h.lc("ngForOf",e.displayedColumns2),h.Cb(3),h.lc("ngForOf",e.headerRowDef2),h.Cb(1),h.lc("matHeaderRowDef",e.headerRowDef),h.Cb(1),h.lc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),h.Cb(1),h.lc("matRowDefColumns",e.displayedColumns))},directives:[v.j,v.c,v.e,v.b,a.k,v.g,v.i,I.a,I.b,v.d,v.a,a.j,P.a,R.a,v.f,v.h,I.c],styles:["table[_ngcontent-%COMP%]{width:100%}.make-red[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]{background-color:#faa}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}th.mat-header-cell[_ngcontent-%COMP%]{border:1px solid #ccc}td.mat-cell[_ngcontent-%COMP%], th.mat-header-cell[_ngcontent-%COMP%]{text-align:center;padding:0!important}.mat-header-row[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{min-height:30px;height:30px}.mat-menu-item[_ngcontent-%COMP%]{height:25px;line-height:25px}  .mat-menu-panel{max-width:400px!important}.highlight[_ngcontent-%COMP%]{border:2px double #00f}.notHighlight[_ngcontent-%COMP%], .rowLabel[_ngcontent-%COMP%]{border:1px solid #ccc}  .mat-tooltip{font-size:16px}"]}),t})();function rt(t,e){1&t&&h.Ob(0,"app-rosta-staff")}function dt(t,e){1&t&&h.Ob(0,"app-rosta-location")}let ft=(()=>{class t{constructor(t,e,s){this.dialog=t,this.rostaService=e,this.store=s,this.tabLoadTimes=[],this.staffList=[],this.dutyList=[],this.myFilter=t=>1===(t||new Date).getDay();const a=new Date,i=a.getDay(),o=0===i?6:i-1;this.restorePreferences(),this.weekCommencing=new Date(new Date(a).setDate(a.getDate()-o)),this.store.dispatch(p.d({dateFrom:this.weekCommencing})),this.staffList$=this.rostaService.getStaffList().subscribe(t=>{this.staffList=t}),this.dutyList$=this.rostaService.getDutyList().subscribe(t=>{this.dutyList=t}),this.store.dispatch(p.a())}restorePreferences(){let t=null;this.store.select(S.d).subscribe(e=>{t=e,this.rostaService.getPreSelectedConfig(t).subscribe(t=>{this.config=t,this.store.dispatch(p.e({dutyIdList:this.config.selected_duties})),this.store.dispatch(p.f({staffIdList:this.config.selected_staff}))})})}ngOnDestroy(){this.staffList$&&this.staffList$.unsubscribe(),this.dutyList$&&this.dutyList$.unsubscribe()}ngOnInit(){}dateChanged(t){console.log("W/C "+t),this.store.dispatch(p.d({dateFrom:t}))}openSPDialog(){this.dialog.open(C,{width:"250px",data:this.staffList}).afterClosed().subscribe(t=>{console.log("Selected Staff "+t),t&&t.length>0&&(this.store.dispatch(p.f({staffIdList:t})),this.config.selected_staff=t,this.rostaService.setPreSelectedConfig(this.config))})}openDutyPickerDialog(){this.dialog.open(D,{width:"450px",data:this.dutyList}).afterClosed().subscribe(t=>{t&&t.length>0&&(this.store.dispatch(p.e({dutyIdList:t})),this.config.selected_duties=t,this.rostaService.setPreSelectedConfig(this.config))})}}return t.\u0275fac=function(e){return new(e||t)(h.Nb(o.b),h.Nb(w.a),h.Nb(n.h))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-rosta-main"]],decls:18,vars:4,consts:[["color","primary",2,"min-height","30px"],["matInput","",1,"dateInput",3,"matDatepickerFilter","ngModel","matDatepicker","readonly","ngModelChange"],["startView","month"],["picker",""],["mat-raised-button","",1,"button-width",3,"click"],[1,"spacer"],["label","Staff View"],["matTabContent",""],["label","Location/Duty View"]],template:function(t,e){if(1&t){const t=h.Ub();h.Tb(0,"mat-toolbar",0),h.Tb(1,"span"),h.Cc(2,"Shift Planner w/c: "),h.Sb(),h.Tb(3,"input",1),h.bc("ngModelChange",function(t){return e.weekCommencing=t})("ngModelChange",function(){return e.dateChanged(e.weekCommencing)}),h.Sb(),h.Ob(4,"mat-datepicker",2,3),h.Tb(6,"button",4),h.bc("click",function(){return h.tc(t),h.rc(5).open()}),h.Cc(7,"Change Date"),h.Sb(),h.Tb(8,"button",4),h.bc("click",function(){return e.openSPDialog()}),h.Cc(9,"Staff List"),h.Sb(),h.Tb(10,"button",4),h.bc("click",function(){return e.openDutyPickerDialog()}),h.Cc(11,"Duty List"),h.Sb(),h.Ob(12,"span",5),h.Sb(),h.Tb(13,"mat-tab-group"),h.Tb(14,"mat-tab",6),h.Bc(15,rt,1,0,"ng-template",7),h.Sb(),h.Tb(16,"mat-tab",8),h.Bc(17,dt,1,0,"ng-template",7),h.Sb(),h.Sb()}if(2&t){const t=h.rc(5);h.Cb(3),h.lc("matDatepickerFilter",e.myFilter)("ngModel",e.weekCommencing)("matDatepicker",t)("readonly",!0)}},directives:[k.a,O.b,b.c,M.b,b.k,b.n,M.a,m.a,T.c,T.a,T.b,G,lt],styles:[".mat-toolbar[_ngcontent-%COMP%]{min-height:40px!important;height:40px!important}.mat-toolbar-row[_ngcontent-%COMP%],   .mat-tab-label{min-height:30px!important;height:30px!important}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.button-width[_ngcontent-%COMP%]{width:200px;margin-left:10px}.dateInput[_ngcontent-%COMP%]{padding-left:10px}"]}),t})();const ht=[{path:"",component:(()=>{class t{constructor(){const t=new Date,e=t.getDay(),s=0===e?6:e-1;this.weekCommencing=new Date(new Date(t).setDate(t.getDate()-s))}ngOnInit(){console.log("Rosta component init")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h.Hb({type:t,selectors:[["app-rosta"]],decls:2,vars:0,template:function(t,e){1&t&&(h.Tb(0,"div"),h.Ob(1,"router-outlet"),h.Sb())},directives:[i.h],styles:["table[_ngcontent-%COMP%]{width:100%}.make-red[_ngcontent-%COMP%], .table-container[_ngcontent-%COMP%]{background-color:#faa}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}td.mat-cell[_ngcontent-%COMP%], th.mat-header-cell[_ngcontent-%COMP%]{text-align:center;border:1px solid #ccc;padding:0!important}.mat-header-row[_ngcontent-%COMP%], .mat-row[_ngcontent-%COMP%]{min-height:30px;height:30px}"]}),t})(),children:[{path:"",component:ft}]}];let ut=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(e){return new(e||t)},imports:[[i.g.forChild(ht)],i.g]}),t})();var bt=s("PCNd"),mt=s("FKr1");let gt=(()=>{class t extends mt.r{getFirstDayOfWeek(){return 1}}return t.\u0275fac=function(e){return Ct(e||t)},t.\u0275prov=h.Jb({token:t,factory:t.\u0275fac}),t})();const Ct=h.Vb(gt);let pt=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(e){return new(e||t)},providers:[{provide:mt.a,useClass:gt},{provide:mt.d,useValue:"en-GB"}],imports:[[a.c,bt.a,ut]]}),t})()}}]);